CXX = gcc

src = prob_func.c consoleapp.c function_tests.c
odir = out
exec = $(odir)/function_tests $(odir)/consoleapp
obj = $(odir)/prob_func.o
lib = $(odir)/libprob_func.so

all : $(odir) $(obj) $(lib) $(exec)

$(odir) :
	mkdir -p $(odir)

$(odir)/prob_func.o : prob_func.c
	$(CXX) -o $@ -c prob_func.c -fPIC

$(odir)/libprob_func.so: $(odir)/prob_func.o
	$(CXX) -shared -o $@ $<

$(odir)/consoleapp: consoleapp.c $(odir)/libprob_func.so prob_func.h
	$(CXX) -o $@ $< -L./$(odir) -Wl,-rpath=. -lprob_func

$(odir)/function_tests: function_tests.c $(odir)/libprob_func.so prob_func.h
	$(CXX) -o $@ $< -L./$(odir) -Wl,-rpath=. -lprob_func

reset :
	rm -rf $(odir)
